<!DOCTYPE html>
<html lang="en">
  <head>
    <link href="/static/mermaid.min.css" rel="stylesheet"/>
  </head>
  <body>
    <input type="checkbox" id="visible" onclick="filter()"/>
    <label for="visible">Visible</label>
    <input type="checkbox" id="messier" onclick="filter()"/>
    <label for="messier">Messier</label>
    <input type="checkbox" id="named" onclick="filter()"/>
    <label for="named">Named</label>

    <div id="wrapper"></div>
    <script src="/static/grid.umd.js"></script>
    <script>
     var filters = [];
     function filter() {
         filters = [];
         const m = document.getElementById("messier");
         if (m.checked) {
             filters.push("messier");
         }
         const n = document.getElementById("named");
         if (n.checked) {
             filters.push("named");
         }

         const v = document.getElementById("visible");
         if (v.checked) {
             filters.push("visible");
         }

         grid.forceRender();
     }

     const grid = new gridjs.Grid({
         search: true,
         pagination: {
             limit: 15,
             server: {
                 url: (prev, page, limit) => {
                     const url = new URL(prev, document.location);
                     url.searchParams.append('page', page);
                     url.searchParams.append('pagesize', limit);
                     filters.forEach((value, index) => {
                         url.searchParams.append(value, "true");
                     });
                     return url.href;
                 }
             }
         },
         search: {
             server: {
                 url: (prev, keyword) => {
                     const url = new URL(prev, document.location);
                     url.searchParams.append('name', keyword);
                     return url.href;
                 }
             }
         },
         server: {
             url: '/objects',
             then: data => data.objects.map(obj => {
                 var id = obj.id
                 if (!obj.visible) {
                     id = `${id}*`
                 }

                 return [
                     gridjs.html(`<a href='/${obj.id}'>${id}</a>`),
                     obj.type,
                     obj.constellation,
                     obj.name
             ]}),
             total: data => data.total
         },
         columns: [
             {
                 name: "id",
                 width: "100px",
             },
             {
                 name: "type",
                 width: "100px",
                 filter: true
             },
             {
                 name: "constellation",
                 width: "100px",
             },
             {
                 name: "name"
             },
         ],
         sort: true,
         data: {{.Objects}}
     }).render(document.getElementById("wrapper"));
    </script>
  </body>
</html>

